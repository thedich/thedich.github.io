var scope=this,_search=function(a,b){function c(){if(void 0==a)var a=0;var b="&ft="+this.ft,e=this.maxrequest-a;console.log("__FREE_REQUSTS__: "+e);for(var f=0;e>f;f++){var g=scope.pull.shift(),h=new XMLHttpRequest;if(g){if(h.open("GET",this.url+encodeURI(g)+b,!1),h.send(),200!=h.status){console.log("request--next : fail");var i=scope.pull.shift();a--,i&&c()}else{console.log("request--next : ok"),d(h.responseText);var i=scope.pull.shift();a--,i&&c()}a++}}}function d(a){function b(a){var b=c(),d=60*b.hour+b.min,e=60*+a.split(":")[0]+ +a.split(":")[1];return d-e<=this.cachetime?!0:!1}function c(){var a=new Date,b=a.getHours(),c=a.getMinutes();return{hour:b,min:c}}var d=[],f=a.split("<item>"),g=f.shift().match(/link>(.+?)>/)[0],h=g.replace(/.+(text.+?)<.+/,"$1"),i=h.split("=")[1];if(scope.cache.hasOwnProperty(i)&&b(cache[i].time))return e(cache[i].links,i),console.log("_FROM_CACHE_"),"^___^";for(var j=0;j<f.length;j++){var k=f[j].match(/link>(.+)<\/link/gi)[0].replace(/link>(.+)<\/link/gi,"$1"),l=k.replace(/.+\/\/(.+)\/.+/gi,"$1");d.push({query:i,linkfull:k,linkshort:l})}var m=c();scope.cache[i]={time:m.hour+":"+m.min,links:d},e(cache[i].links,i)}function e(a,b){for(var c in a){scope.stats.hasOwnProperty(a[c].linkshort)||(scope.stats[a[c].linkshort]=0);var d=+scope.stats[a[c].linkshort];f(b,a[c].linkfull)&&d++,scope.stats[a[c].linkshort]=d}}function f(a,b){for(var c in scope.cache)if(c!==a)for(var d=scope.cache[c].links,e=0;e<d.length;e++)if(d[e].linkfull==b)return!1;return!0}var g=b;if(scope.pull||(scope.pull=[]),scope.stats||(scope.stats={}),scope.cache||(scope.cache={}),this.cachetime||(this.cachetime=40),this.prettyprint||(this.prettyprint=!0),this.maxrequest||(this.maxrequest=10),this.url||(this.url="http://blogs.yandex.ru/search.rss?text="),this.ft||(this.ft="blog,forum,comments"),g)for(var h in g)this.hasOwnProperty(h)&&(this[h]=g[h]);if(!a)return console.log("QUERY_ERROR---Query in Empty"),"^___^";try{a.charAt(0)}catch(i){return console.log("QUERY_ERROR---Query in NOT a String"),"^___^"}!function(a){for(var b=a.split("&"),c=0;c<b.length;c++)scope.pull.push(b[c].split("=")[1])}(a),c(),d(testXML),_search.getStats=function(){return this.prettyprint||JSON.stringify(scope.stats),JSON.stringify(scope.stats,null,2)}};